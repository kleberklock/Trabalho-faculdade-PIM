<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Chamados - Sistema de Gestão de Chamados</title>
    <link rel="stylesheet" href="style.css"> 
    </head>
<body>
    <header class="main-header">
        <div class="container">
            <h1 class="logo">Sistema de Chamados</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="novo-chamado.html">Novo Chamado</a></li>
                    <li><a href="meus-chamados.html">Meus Chamados</a></li>
                    <li><a href="gerenciar-chamados.html">Gerenciar Chamados</a></li>
                    <li><a href="ia-interface.html">Interface IA</a></li>
                    <li><a href="consultar-produtos.html">Consultar Produtos</a></li>
                    <li><a href="index.html">Sair</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content container">
        <h2 class="section-title">Gerenciar Chamados (Administrador)</h2>

        <div class="responsive-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Solicitante</th>
                        <th>Assunto</th>
                        <th>Data Abertura</th>
                        <th>Prioridade</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>001</td>
                        <td>João Silva</td>
                        <td>Problema com acesso à VPN</td>
                        <td>20/10/2025</td>
                        <td><span class="status-badge alta">Alta</span></td>
                        <td><span class="status-badge em-andamento">Em Andamento</span></td>
                        <td><a href="#">Editar</a> / <a href="#">Excluir</a></td>
                    </tr>
                    <tr>
                        <td>002</td>
                        <td>Maria Souza</td>
                        <td>Erro ao gerar relatório de vendas</td>
                        <td>18/10/2025</td>
                        <td><span class="status-badge media">Média</span></td>
                        <td><span class="status-badge pendente">Pendente</span></td>
                        <td><a href="#">Editar</a> / <a href="#">Excluir</a></td>
                    </tr>
                    <tr>
                        <td>003</td>
                        <td>Pedro Costa</td>
                        <td>Solicitação de instalação de software</td>
                        <td>15/10/2025</td>
                        <td><span class="status-badge baixa">Baixa</span></td>
                        <td><span class="status-badge concluido">Concluído</span></td>
                        <td><a href="#">Editar</a> / <a href="#">Excluir</a></td>
                    </tr>
                    <tr>
                        <td>004</td>
                        <td>Ana Lima</td>
                        <td>Mouse não funciona</td>
                        <td>10/10/2025</td>
                        <td><span class="status-badge media">Média</span></td>
                        <td><span class="status-badge concluido">Concluído</span></td>
                        <td><a href="#">Editar</a> / <a href="#">Excluir</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 Sistema de Gestão de Chamados. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script>
    // Função para pegar a classe CSS correta para o status/prioridade
    function getBadgeClass(text) {
        if (!text) return 'baixa';
        
        switch (text.toLowerCase()) {
            case 'alta':
            case 'erro':
                return 'alta';
            case 'media':
            case 'pendente':
                return 'media';
            case 'baixa':
                return 'baixa';
            case 'concluido':
                return 'concluido';
            case 'em andamento':
                return 'em-andamento';
            default:
                return 'baixa';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const tabelaBody = document.querySelector('table tbody');
        tabelaBody.innerHTML = '<tr><td colspan="7">Carregando chamados...</td></tr>';

        const apiUrl = 'http://localhost:5001/api/chamados';

        fetch(apiUrl)
            .then(response => response.json())
            .then(chamados => {
                tabelaBody.innerHTML = ''; // Limpa a tabela

                chamados.forEach(chamado => {
                    const tr = document.createElement('tr');
                    
                    const prioridadeClass = getBadgeClass(chamado.prioridade);
                    const statusClass = getBadgeClass(chamado.status);
                    const dataFormatada = new Date(chamado.dataSolicitacao).toLocaleDateString('pt-BR');

                    // A única diferença: adiciona a coluna "chamado.solicitanteNome"
                    tr.innerHTML = `
                        <td>${chamado.idSolicitacao.toString().padStart(3, '0')}</td>
                        <td>${chamado.solicitanteNome}</td> 
                        <td>${chamado.assunto}</td>
                        <td>${dataFormatada}</td>
                        <td><span class="status-badge ${prioridadeClass}">${chamado.prioridade}</span></td>
                        <td><span class="status-badge ${statusClass}">${chamado.status}</span></td>
                        <td><a href="#">Editar</a> / <a href="#">Excluir</a></td>
                    `;
                    tabelaBody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Erro ao buscar chamados:', error);
                tabelaBody.innerHTML = `<tr><td colspan="7">Erro ao carregar chamados. A API está rodando?</td></tr>`;
            });
    });
</script>
</body>
</html>
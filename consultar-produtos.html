<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultar Produtos - Sistema de Gestão de Chamados</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1 class="logo">Sistema de Chamados</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="novo-chamado.html">Novo Chamado</a></li>
                    <li><a href="meus-chamados.html">Meus Chamados</a></li>
                    <li><a href="gerenciar-chamados.html">Gerenciar Chamados</a></li>
                    <li><a href="ia-interface.html">Interface IA</a></li>
                    <li><a href="consultar-produtos.html">Consultar Produtos</a></li>
                    <li><a href="index.html">Sair</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content container">
        <h2 class="section-title">Consultar Produtos e Estoque</h2>

        <div class="responsive-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome do Produto</th>
                        <th>Preço</th>
                        <th>Data de Fabricação</th>
                        <th>Validade</th>
                        <th>Disponibilidade</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>PROD001</td>
                        <td>Monitor Dell 24"</td>
                        <td>R$ 1.200,00</td>
                        <td>01/01/2025</td>
                        <td>Indeterminada</td>
                        <td><span class="status-badge concluido">Em Estoque</span></td>
                    </tr>
                    <tr>
                        <td>PROD002</td>
                        <td>Teclado Mecânico Logitech</td>
                        <td>R$ 350,00</td>
                        <td>15/02/2025</td>
                        <td>Indeterminada</td>
                        <td><span class="status-badge concluido">Em Estoque</span></td>
                    </tr>
                    <tr>
                        <td>PROD003</td>
                        <td>SSD Samsung 1TB</td>
                        <td>R$ 600,00</td>
                        <td>10/03/2025</td>
                        <td>Indeterminada</td>
                        <td><span class="status-badge erro">Indisponível</span></td>
                    </tr>
                    <tr>
                        <td>PROD004</td>
                        <td>Webcam Full HD</td>
                        <td>R$ 200,00</td>
                        <td>20/04/2025</td>
                        <td>Indeterminada</td>
                        <td><span class="status-badge concluido">Em Estoque</span></td>
                    </tr>
                    <tr>
                        <td>PROD005</td>
                        <td>Impressora Multifuncional HP</td>
                        <td>R$ 950,00</td>
                        <td>05/05/2025</td>
                        <td>Indeterminada</td>
                        <td><span class="status-badge erro">Indisponível</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 Sistema de Gestão de Chamados. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script>
    // Executa quando o conteúdo da página (HTML) estiver carregado
    document.addEventListener('DOMContentLoaded', function() {
        
        // 1. Encontra o corpo da tabela no seu HTML
        const tabelaBody = document.querySelector('table tbody');
        
        // 2. Limpa as linhas estáticas (de exemplo) que estão no HTML
        tabelaBody.innerHTML = '<tr><td colspan="6">Carregando produtos...</td></tr>';

        // 3. Define a URL da sua API (verifique se a porta 5001 está correta)
        const apiUrl = 'http://localhost:5001/api/produtos';

        // 4. Chama a API do back-end (C#)
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Não foi possível carregar os produtos. A API está rodando?');
                }
                return response.json(); // Converte a resposta em JSON
            })
            .then(produtos => {
                // 5. Sucesso! Temos a lista de produtos. Vamos limpar a tabela de novo
                tabelaBody.innerHTML = '';

                // 6. Se a lista estiver vazia, mostra uma mensagem
                if (produtos.length === 0) {
                    tabelaBody.innerHTML = '<tr><td colspan="6">Nenhum produto encontrado.</td></tr>';
                    return;
                }

                // 7. Loop para cada produto que veio da API
                produtos.forEach(produto => {
                    // Cria uma nova linha <tr>
                    const tr = document.createElement('tr');

                    // Formata o Preço para Reais (R$)
                    const precoFormatado = produto.precoProduto.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                    // Formata a Disponibilidade (para bater com o seu style.css)
                    const disponibilidade = produto.disponivel 
                        ? '<span class="status-badge concluido">Em Estoque</span>' 
                        : '<span class="status-badge erro">Indisponível</span>';

                    // Formata as Datas
                    const dataFab = new Date(produto.dataFabricacao).toLocaleDateString('pt-BR');
                    
                    let dataVal = new Date(produto.validade).toLocaleDateString('pt-BR');
                    // Se o ano for 9999, mostramos "Indeterminada" (como no seu HTML estático)
                    if (new Date(produto.validade).getFullYear() > 9000) {
                        dataVal = 'Indeterminada';
                    }
                    
                    // Preenche a linha com os dados
                    tr.innerHTML = `
                        <td>PROD${produto.idProduto.toString().padStart(3, '0')}</td>
                        <td>${produto.nomeProduto}</td>
                        <td>${precoFormatado}</td>
                        <td>${dataFab}</td>
                        <td>${dataVal}</td>
                        <td>${disponibilidade}</td>
                    `;

                    // Adiciona a nova linha na tabela
                    tabelaBody.appendChild(tr);
                });
            })
            .catch(error => {
                // 8. Se der erro no 'fetch'
                console.error('Erro ao buscar produtos:', error);
                tabelaBody.innerHTML = `<tr><td colspan="6">Erro ao carregar dados: ${error.message}</td></tr>`;
            });
    });
</script>
</body>
</html>